<HTML>
	<HEAD>
		<TITLE>
			C言語初めてのゲーム(走り抜けジャンプ)
		</TITLE>
	</HEAD>

	<BODY bgcolor="#b8d4ef" topmargin="50" leftmargin="50" marginheight="40" marginwidth="40">
		<p>
			<div align="center"><font size="7">C言語初めてのゲーム(走り抜けジャンプ)</font></div>
		</p>

		<h2>
			対象
			<hr color="#99baff">
		</h2>
		<p>
			&emsp;描画と音の再生をある程度使えた人がが対象となります。<br><br><br><br><br>
		</p>

		<h2>
			内容
			<hr color="#99baff">
		</h2>
		<p>
			&emsp;走り抜けのジャンプというある程度簡単なゲームを通して一通りのゲームを作り方を勉強します。C言語を終えていることを前提として説明するのでわからない部分が出たら学びなおしてください。<br>
			また、前回などで説明したDxlibの関数に関しては説明しません。
			<br>
			※作者が疲れたのでもっと単調なものに変わってるかもしれません。<br><br><br><br><br>
		</p>
		<h2>
			構成
			<hr color="#99baff">
		</h2>
		<p>
			<a href="#R1">No.1 本編についての説明<br></a>
			<a href="#R2">No.2 おまじない<br></a>
			<a href="#R3">No.3 タイトル<br></a>
			&emsp;<a href="#R3-1">No.3-1 準備および背景描画<br></a>
			&emsp;<a href="#R3-2">No.3-2 選択肢のカーソルとボタン<br></a>
			<br><br><br><br><br>
		</p>

		<h2>
			本編
			<hr color="#99baff">
		</h2>

		<h3>
			<a name="R1">
				No.1 本編についての説明
			</a>
			<hr color="#99baff">
		</h3>
		<p>
			&emsp;今回ですが、走り抜けのゲームを作ります。最低限のキャラの動作とあたり判定、敵の生成や疑似スクロールを勉強します。<br>
			<br>
			といってもこれから書きながらソースコードを組むので少し変わるかもしれません。まぁ、簡単なことには変わりはないので身構えずにだらだらとやってください。<br>
			<br>
			ただどんな説明を行えばいいのか私も初心者ですのでいらん事書いてたりちょっと端折ってるかもしれません。<br>
			<br><br>
			この構成ですが、必要な要素を伝えた後にそれを含んだソースコードを見せるといったやり方で説明します。<br><br><br><br><br>
		</p>

		<h3>
			<a name="R2">
				No.2 おまじない
			</a>
			<hr color="#99baff">
		</h3>
		<p>
			&emsp;おまじないです。とりあえずこれを書いてください。<br>
			<br>
			<pre>
			<code>
<div style="background:#EFEFEF;width:970px;border:1px solid #CC0000; height:600px;">
<ol>
<li>#include "DxLib.h"</li>
<li></li>
<li>int WINAPI WinMain(HINSTANCE,HINSTANCE,LPSTR,int)</li>
<li>{</li>
<li>        ChangeWindowMode(TRUE);				// ウィンドウモード変更</li>
<li>        DxLib_Init();						// 初期化</li>
<li>        SetDrawScreen( DX_SCREEN_BACK ); 	// 裏画面設定</li>
<li></li>
<li>        while( ScreenFlip()==0 && ProcessMessage()==0 && ClearDrawScreen()==0 && CheckHitKey(KEY_INPUT_ESCAPE)==0)</li>
<li>        {</li>
<li></li>
<li>        }</li>
<li>                </li>
<li>        DxLib_End(); // DXライブラリ終了処理</li>
<li>        return 0;</li>
<li>}</li>
</ol>
</div>
			</code>
			</pre>
			<br>
			&emsp;もう言うことない。説明なし。次行こうー。<br>
			<br><br><br><br>
		</p>

		<h3>
			<a name="R3">
				No.3 タイトル
			</a>
			<hr color="#99baff">
		</h3>
		<p>
			&emsp;ゲームを起動して最初に出会うやつ、タイトルを作ります。<br>
			<br>
			タイトルなんて簡単でしょー？<br>
			<br>
			いや簡単ですけど説明長そうなんでいくつかに分けて説明します。<br>
			正直プログラミングに対してある程度わかる人はNo,3の最後のソースコードでどういったことが行われているか見て学ぶだけでもいいかもしれないレベルです。<br>
			<br><br><br><br>
		</p>

		<h4>
			<a name="R3-1">
				No.3-1 準備および背景描画
			</a>
			<hr color="#99baff">
		</h4>
		<p>
			&emsp;タイトルに必要なものの変数や関数はたくさんあります。<br>
			ですが、一気に出しても混乱するのでまずはタイトルとして実行される関数と、それだけでは味気ないので背景を描画させます。<br>
			<br><br>
			&emsp;タイトルに限らずですが、動作を管理するのに<font color="red">【描画】【操作】</font>と分けた方が扱いやすいです。<br>
			ということでそれらの関数を作ります。<br>
			<PRE><font color="blue">
void Title_Draw(void);		// 描画の中身を管理
void Title_Process(void);	// 操作の中身を管理
			</font></PRE>
			<br>
			&emsp;こいつらが基本的にタイトルのほぼすべてを持ってると考えてください。<br>
			ですが、二つの関数をいちいち呼び出すのは煩わしいので私はそれらをもつ関数を作ります。<br>
			<br>
			<PRE><font color="blue">
void Title_Update(void);	// 描画と操作の実体を管理
			</font></PRE>
			&emsp;そうすることでタイトルの呼び出しはこいつだけで済みます。<br>
			<br><br>
			管理をする関数は出来ましたが、これらはタイトルを扱う上でマイループ行われます。ですが、その中に画像のロードとか入れたくありません。<br>
			ということで、初期化を一括で行う関数を作ります。<br>
			<br>
			<PRE><font color="blue">
void Initialize_Title(void);	// タイトルの要素の初期化
			</font></PRE>
			<br>
			&emsp;また、使い終わった後に削除するための関数を作ります。
			<PRE><font color="blue">
void Delete_Title(void);	// タイトルの要素の削除
			</font></PRE>
			<br>
			&emsp;これでタイトルの準備は終わりです。<br>
			<br><br><br>
			それらを組み込んであげたソースコードが以下のようになります。<br>
			<br>
			<pre>
			<code>
<div style="background:#EFEFEF;width:970px;border:1px solid #CC0000; height:2280px;">
<ol>
<li>#include "DxLib.h"</li>
<li></li>
<li><font color="red">// 初期化</font></li>
<li><font color="red">void Initialize_Title(void);	// タイトルの要素の初期化</font></li>
<li></li>
<li><font color="red">// 削除</font></li>
<li><font color="red">void Delete_Title(void);	// タイトルの要素の削除</font></li>
<li></li>
<li><font color="red">// タイトルの実体</font></li>
<li><font color="red">void Title_Update(void);	// タイトルの描画と操作の実体を管理</font></li>
<li><font color="red">void Title_Draw(void);		// タイトルの描画の中身を管理</font></li>
<li><font color="red">void Title_Process(void);	// タイトルの操作の中身を管理</font></li>
<li></li>
<li><font color="red">// タイトル要素</font></li>
<li><font color="red">int gr_title_back;	// タイトルの背景</font></li>
<li></li>
<li>int WINAPI WinMain(HINSTANCE,HINSTANCE,LPSTR,int)</li>
<li>{</li>
<li>        ChangeWindowMode(TRUE);				// ウィンドウモード変更</li>
<li>        DxLib_Init();						// 初期化</li>
<li>        SetDrawScreen( DX_SCREEN_BACK ); 	// 裏画面設定</li>
<li></li>
<li><font color="red">	Initialize_Title();		// タイトルの初期化の呼び出し</font></li>
<li></li>
<li>        while( ScreenFlip()==0 && ProcessMessage()==0 && ClearDrawScreen()==0 && CheckHitKey(KEY_INPUT_ESCAPE)==0)</li>
<li>        {</li>
<li><font color="red">		Title_Update();		// タイトル</font></li>
<li>        }</li>
<li></li>
<li><font color="red">	Delete_Title();			// タイトルの削除</font></li>
<li></li>
<li>        DxLib_End(); // DXライブラリ終了処理</li>
<li>        return 0;</li>
<li>}</li>
<li></li>
<li><font color="red">// タイトルの初期化</font></li>
<li><font color="red">void Initialize_Title()</font></li>
<li><font color="red">{</font></li>
<li><font color="red">	gr_title_back = LoadGraph("media\\title_background.png");</font></li>
<li><font color="red">}</font></li>
<li></li>
<li><font color="red">// タイトルの削除</font></li>
<li><font color="red">void Delete_Title()</font></li>
<li><font color="red">{</font></li>
<li><font color="red">	DeleteGraph(gr_title_back);</font></li>
<li><font color="red">}</font></li>
<li></li>
<li><font color="red">// タイトルのすべて</font></li>
<li><font color="red">void Title_Update()</font></li>
<li><font color="red">{</font></li>
<li><font color="red">	Title_Draw()</font></li>;
<li><font color="red">	Title_Process();</font></li>
<li><font color="red">}</font></li>
<li></li>
<li><font color="red">// タイトルの描画</font></li>
<li><font color="red">void Title_Draw()</font></li>
<li><font color="red">{</font></li>
<li><font color="red">	DrawGraph(0, 0, gr_title_back, false);</font></li>
<li><font color="red">}</font></li>
<li></li>
<li><font color="red">// タイトルの操作</font></li>
<li><font color="red">void Title_Process()</font></li>
<li><font color="red">{</font></li>
<li><font color="red">	// 操作は今ないので何も書かないで構いません。</font></li>
<li><font color="red">}</font></li>
</ol>
</div>
			</code>
			</pre>
			<br><br>
			&emsp;ここで何が行われているかわからないと絶望です。<br>
			<br><br><br><br>
		</p>

		<h4>
			<a name="R3-2">
				No.3-2 選択肢のカーソルとボタン
			</a>
			<hr color="#99baff">
		</h4>
		<p>
			&emsp;今回の重要な部分はカーソルです。<br>
			<br>
			&emsp;カーソルはY座標を移動し、場所によって決定キーの実行結果が変わります。<br>
			それらについて必要な要素としてカーソルの画像とそれぞれのアイコンの画像とカーソルの位置を把握する変数です。用意します。<br>
			<pre><font color="blue">
int gr_title_cursor;	// カーソル絵
int gr_title_start;	// 始めるアイコン画像
int gr_title_end;	// 終わるアイコン画像
// 操作
int title_cursor_y;	// カーソル動作
			</font></pre>
			<br>
			&emsp;また、ゲーム中の処理はまだ作っていないので終了するときの処理だけ付け加えます。<br>
			<br>
			<pre><font color="blue">
// 終了
bool endflag;
			</font></pre>
			<br>
			&emsp;追加要素は以上です。ですが、今までに記入してきた関数内は変更します。<br>
			<br>
			<pre>
			<code>
<div style="background:#EFEFEF;width:1200px;border:1px solid #CC0000; height:3900px;">
<ol>
<li>#include "DxLib.h"</li>
<li></li>
<li>// 初期化</li>
<li>void Initialize_Title(void);	// タイトルの要素の初期化</li>
<li></li>
<li>// 削除</li>
<li>void Delete_Title(void);	// タイトルの要素の削除</li>
<li></li>
<li>// タイトルの実体</li>
<li>void Title_Update(void);	// タイトル描画と操作の実体を管理</li>
<li>void Title_Draw(void);		// タイトルの描画の中身を管理</li>
<li>void Title_Process(void);	// 操作の中身を管理</li>
<li></li>
<li>// タイトル要素</li>
<li>// 描画</li>
<li>int gr_title_back;	// 背景</li>
<li><font color="red">int gr_title_cursor;	// カーソル絵</font></li>
<li><font color="red">int gr_title_start;	// 始めるアイコン画像</font></li>
<li><font color="red">int gr_title_end;	// 終わるアイコン画像</font></li>
<li><font color="red">// 操作</font></li>
<li><font color="red">int title_cursor_y;	// カーソル動作</font></li>
<li></li>
<li><font color="red">// 終了</font></li>
<li><font color="red">bool endflag;</font></li>
<li></li>
<li>int WINAPI WinMain(HINSTANCE,HINSTANCE,LPSTR,int)</li>
<li>{</li>
<li>        ChangeWindowMode(TRUE);				// ウィンドウモード変更</li>
<li>        DxLib_Init();						// 初期化</li>
<li>        SetDrawScreen( DX_SCREEN_BACK ); 	// 裏画面設定</li>
<li></li>
<li>	endflag = false;</li>
<li></li>
<li>	Initialize_Title();		// タイトルの初期化の呼び出し</li>
<li></li>
<li>        while( ScreenFlip()==0 && ProcessMessage()==0 && ClearDrawScreen()==0 && CheckHitKey(KEY_INPUT_ESCAPE)==0 && endflag == false)</li>
<li>        {</li>
<li>		Title_Update();		// タイトル</li>
<li>        }</li>
<li></li>
<li>	Delete_Title();			// タイトルの削除</li>
<li></li>
<li>        DxLib_End(); // DXライブラリ終了処理</li>
<li>        return 0;</li>
<li>}</li>
<li></li>
<li>// タイトルの初期化</li>
<li>void Initialize_Title()</li>
<li>{</li>
<li>	// 描画</li>
<li>	gr_title_back = LoadGraph("media\\title_background.png");</li>
<li><font color="red">	gr_title_cursor = LoadGraph("media\\title_cursor.png");</font></li>
<li><font color="red">	gr_title_start = LoadGraph("media\\title_start.png");</font></li>
<li><font color="red">	gr_title_end = LoadGraph("media\\title_end.png");</font></li>
<li></li>
<li><font color="red">	title_cursor_y = 0;</font></li>
<li>}</li>
<li></li>
<li>// タイトルの削除</li>
<li>void Delete_Title()</li>
<li>{</li>
<li>	DeleteGraph(gr_title_back);</li>
<li><font color="red">	DeleteGraph(gr_title_cursor);</font></li>
<li><font color="red">	DeleteGraph(gr_title_start);</font></li>
<li><font color="red">	DeleteGraph(gr_title_end);</font></li>
<li>}</li>
<li></li>
<li>// タイトルのすべて</li>
<li>void Title_Update()</li>
<li>{</li>
<li>	Title_Draw();</li>
<li>	Title_Process();</li>
<li>}</li>
<li></li>
<li>// タイトルの描画</li>
<li>void Title_Draw()</li>
<li>{</li>
<li>	DrawGraph(0, 0, gr_title_back, false);</li>
<li><font color="red">	DrawGraph(240, 300 + (50 * title_cursor_y), gr_title_cursor, true);</font></li>
<li><font color="red">	DrawGraph(290, 300, gr_title_start, true);</font></li>
<li><font color="red">	DrawGraph(290, 350, gr_title_end, true);</font></li>
<li>}</li>
<li></li>
<li>// タイトルの操作</li>
<li>void Title_Process()</li>
<li>{</li>
<li><font color="red">	if(CheckHitKey(KEY_INPUT_UP) == 1)</font></li>
<li><font color="red">	{</font></li>
<li><font color="red">		if(title_cursor_y != 0)</font></li>
<li><font color="red">		{</font></li>
<li><font color="red">			title_cursor_y++;</font></li>
<li><font color="red">		}</font></li>
<li><font color="red">	}</font></li>
<li><font color="red">	if(CheckHitKey(KEY_INPUT_DOWN) == 1)</font></li>
<li><font color="red">	{</font></li>
<li><font color="red">		if(title_cursor_y != 1)</font></li>
<li><font color="red">		{</font></li>
<li><font color="red">			title_cursor_y--;</font></li>
<li><font color="red">		}</font></li>
<li><font color="red">	}</font></li>
<li></li>
<li><font color="red">	if(CheckHitKey(KEY_INPUT_Z) == 1)</font></li>
<li><font color="red">	{</font></li>
<li><font color="red">		if(title_cursor_y == 0)</font></li>
<li><font color="red">		{</font></li>
<li><font color="red">			</font></li>
<li><font color="red">		}</font></li>
<li><font color="red">		else if(title_cursor_y == 1)</font></li>
<li><font color="red">		{</font></li>
<li><font color="red">			endflag = true;</font></li>
<li><font color="red">		}</font></li>
<li><font color="red">	}</font></li>
<li>}</li>
</ol>
</div>
			</code>
			</pre>
			<br>
			&emsp;今回の関数内の変更ではそこまで難しくないですが一応説明します。<br>
			<br><br><br>
			<font color="red">【WinMain()】</font><br>
			<br>
			&emsp;ここでは、先ほど追加した【endflag】を終了処理として増やしました。【false】だったらwhile文をずっと繰り返すというものです。<br>
			<br><br>
			<font color="red">【Title_Process()】</font><br>
			<br>
			&emsp;ここで、カーソルに関する処理を行っています。<br>
			十字キーの入力を取得して、その場所によってＺキーを押されたら別々の処理を行うようにするものです。<br>
			<br><br>
			一つ一つ見ていくと大変なので同じ関数は端折ります。<br>
			<br><br><br>
			<font color="blue">【CheckHitKey()】</font><br>
			<br>
			&emsp;これはユーザーの入力を取得する関数です。<br>
			<br>
			【== 1】というのは一回入力されたら、という意味です。if文はいつものなので身構えなくて大丈夫です。<br>
			<br><br>
			気づいた人はいるかもしれませんが、ある部分を変えればキーを変えれます。<br>
			<br>
			【KEY_INPUT_○】のまるの部分です。<br>
			気になる人はいろいろいじってみてください。<br>
			<br>
			&emsp;これに関する説明は大変、大変なので端折ります。もっと気になる人はリファレンスを参照するといいと思います。<br>
			<a href="http://dxlib.o.oo7.jp/dxfunc.html">リファレンス</a><br>
			<br><br><br>
			&emsp;次にProcess内の【title_cursor_y】に関するif文ですが・・・<br>
			<br>
			上二つのif文ではカーソルの移動制限を行っています。下二つのif文ではカーソルの位置によってＺキーを押すと別々の処理が行われる。<br>
			<br>
			そういったものです。小難しいように思えますがものすごく単純なことなのでちょっと考えてみてください。<br>
			<br><br><br><br>
			&emsp;これでタイトルの大まかな処理は終了です。次はエンディング画面を作ります。エンディング画面と言ってもそこまでたいそうなものは作りません。<br>
			また、ゲーム画面は単純なゲームと言っても大変なので最後に説明します。<br>
			<br>
			<a href="C言語初めてのゲーム(走り抜けジャンプ)-part2.html">C言語初めてのゲーム(走り抜けジャンプ)-part2</a><br>
			<br><br><br><br>
			Copyright (C) 2002-2009 Xiph.org Foundation

			Redistribution and use in source and binary forms, with or without
			modification, are permitted provided that the following conditions
			are met:

			- Redistributions of source code must retain the above copyright
			notice, this list of conditions and the following disclaimer.

			- Redistributions in binary form must reproduce the above copyright
			notice, this list of conditions and the following disclaimer in the
			documentation and/or other materials provided with the distribution.

			- Neither the name of the Xiph.org Foundation nor the names of its
			contributors may be used to endorse or promote products derived from
			this software without specific prior written permission.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
			``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
			LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
			A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE FOUNDATION
			OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
			SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
			LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
			DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
			THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
			(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
			OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

	
			libpng Copyright (C) 2004, 2006-2012 Glenn Randers-Pehrson.
			zlib Copyright (C) 1995-2012 Jean-loup Gailly and Mark Adler.

	
			DX Library Copyright (C) 2001-2014 Takumi Yamada.
		</p>
	</BODY>
</HTML>